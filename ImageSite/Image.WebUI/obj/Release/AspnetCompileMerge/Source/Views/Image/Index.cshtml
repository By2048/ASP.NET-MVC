
@{
    ViewBag.Title = "TestIndex";
    Layout = null;
}

<script type="text/javascript">
    //改变透明度参数：图片对象，透明度：1-100的值
    function setAlpha(imgObj, opacityValue) {
        imgObj.filters.alpha.opacity = parseInt(opacityValue);
    }
    //图片的显示大小[以宽度来限制]
    function DrawImageW(imgObj, widthValue) {
        var image = new Image();
        image.src = imgObj.src;
        if (image.width > 0 && image.height > 0) {
            if (image.width >= widthValue) {
                imgObj.width = widthValue;
                imgObj.height = (image.height * widthValue) / image.width;
            } else {
                imgObj.width = image.width;
                imgObj.height = image.height;
            }
        }
    }
    //图片的显示大小[以高度来限制]
    function DrawImageH(imgObj, heightValue) {
        var image = new Image();
        image.src = imgObj.src;
        if (image.width > 0 && image.height > 0) {
            if (image.height >= heightValue) {
                imgObj.height = heightValue;
                imgObj.width = (image.width * heightValue) / image.height;
            } else {
                imgObj.width = image.width;
                imgObj.height = image.height;
            }
        }
    }
    //图片的显示大小[宽高同时限制]
    function DrawImage(imgObj, widthValue, heightValue) {
        var image = new Image();
        image.src = imgObj.src;
        if (image.width > 0 && image.height > 0) {
            if (image.height > heightValue || image.width > widthValue) {
                var h = 0, w, wflg = false;
                if (image.height > heightValue)
                    wflg = true;
                if (wflg) {
                    w = widthValue;
                    h = (image.height * widthValue) / image.width;
                }
                if (h == 0 || h > heightValue) {
                    h = heightValue;
                    w = (image.width * heightValue) / image.height;
                }
                //alert(w)
                //alert(h)
                imgObj.width = w;
                imgObj.height = h;
            } else {
                imgObj.width = image.width;
                imgObj.height = image.height;
            }
        }
    }
    function zoomImg(imgObj) {
        var zoom = parseInt(imgObj.style.zoom, 10) || 100; zoom += event.wheelDelta / 12;
        if (zoom > 0)
            imgObj.style.zoom = zoom + '%';
        return false;
    }

</script>

<style>
    .content_right {
        float: right;
        height: 750px;
        margin-right: 15px;
        width: 850px;
    }

    .show_image {
        display: table;
        width: 900px;
        height: 700px;
        text-align: center;
    }

        .show_image span {
            display: table-cell;
            vertical-align: middle;
        }

        .show_image image {
            vertical-align: middle;
        }

    .image_page_list {
        width: 850px;
        height: 50px;
        text-align: center;
        bottom: 0;
        position: absolute;
    }

        .image_page_list .pagination-container {
            height: 50px;
        }
</style>


@{
    int curPage = Image.WebUI.Models.Home.HomeIndexModel.PageImage.PageIndex;
    int nextPage = curPage + 1;
    int prevPage = curPage - 1;

    int folderId = Image.WebUI.Models.Home.HomeIndexModel.FolderId;
    int folderPage;

    if (Image.WebUI.Models.Home.HomeIndexModel.PageFolder != null)
    {
        folderPage = Image.WebUI.Models.Home.HomeIndexModel.PageFolder.PageIndex;
    }
    else
    {
        folderPage = 1;
    }

    string keyWord;
    if (Image.WebUI.Models.Home.HomeIndexModel.KeyWord != "")
    {
        keyWord = Image.WebUI.Models.Home.HomeIndexModel.KeyWord;
    }
    else
    {
        keyWord = "";
    }
}

<div class="content_right">
    <div class="show_image">
        @foreach (var item in Image.WebUI.Models.Home.HomeIndexModel.PageImage.GetPagingData())
        {
            <span>
                <img src="@item.Path" alt="@item.Name" class="img-thumbnail" onload="javascript: DrawImage(this,900,700)"/>
            </span>
        }
    </div>
    <div class="image_page_list">
        @if (Image.WebUI.Models.Home.HomeIndexModel.PageImage.HasPrev)
        {
            <a href="@Url.Action("Index", "Home",new { folderPage = folderPage, folderId =folderId, imagePage = prevPage})">上一页</a>
        }
        else
        {
            <span>上一页</span>
        }
        @if (Image.WebUI.Models.Home.HomeIndexModel.PageImage.HasNext)
        {
            <a href="@Url.Action("Index", "Home",new { folderPage = folderPage, folderId =folderId, imagePage = nextPage})">下一页</a>
        }
        else
        {
            <span>下一页</span>
        }
    </div>
</div>


<script>
    $(document).ready(function () {
        //初始化加载是否添加收藏
        $.ajax({
            type: "POST",
            url: "/Favorite/IsAddFavorites",
            data: {
                FolderId: @folderId,
            },
            success: function (data) {
                if (data.status == true) {
                    $("#btnFavorite span").removeClass("glyphicon glyphicon-heart-empty");
                    $("#btnFavorite span").addClass("glyphicon glyphicon-heart");
                }
            }
        });

        //未添加收藏添加
        //添加则删除
        $("#btnFavorite").click(function () {
            //添加
            $.ajax({
                type: "POST",
                url: "/Favorite/AddFavorites",
                data: {
                    FolderId: @folderId,
                },
                success: function (data) {
                    if (data.status == true) {
                        $("#btnFavorite span").removeClass("glyphicon glyphicon-heart-empty");
                        $("#btnFavorite span").addClass("glyphicon glyphicon-heart");
                    } else {
                        //删除
                        $.ajax({
                            type: "POST",
                            url: "/Favorite/DelFavorites",
                            data: {
                                FolderId: @folderId,
                            },
                            success: function (data) {
                                if (data.status == true) {
                                    $("#btnFavorite span").removeClass("glyphicon glyphicon-heart");
                                    $("#btnFavorite span").addClass("glyphicon glyphicon-heart-empty");
                                }
                            }
                        });
                    }
                }
            });
        });
    });
</script>